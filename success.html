<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Payment Successful — Flavour Hub</title>
  <style>
    :root{--bg:#ffffff;--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--soft:#f8fafc;--r:18px;--accent:#ef4444;--accent2:#f97316;--max:900px}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--ink)}
    .wrap{max-width:var(--max);margin:0 auto;padding:18px}
    .card{border:1px solid var(--line);border-radius:var(--r);background:#fff;padding:16px;margin-top:14px}
    .ok{display:flex;gap:12px;align-items:center}
    .badge{width:46px;height:46px;border-radius:16px;display:grid;place-items:center;color:#fff;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent2))}
    .muted{color:var(--muted);font-size:13px;line-height:1.45}
    .row{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .items{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .it{border:1px solid var(--line);background:var(--soft);border-radius:14px;padding:10px;display:flex;justify-content:space-between;gap:10px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    a.btn{display:inline-block;text-decoration:none;font-weight:900;padding:12px 14px;border-radius:14px;border:1px solid var(--line);color:var(--ink);background:#fff}
    a.btn.primary{border:none;color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent2))}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="ok">
      <div class="badge">FH</div>
      <div>
        <h2 style="margin:0">Payment Successful</h2>
        <div class="muted" id="refLine">Reference: —</div>
      </div>
    </div>
  </div>

  <div class="card" id="orderCard" style="display:none">
    <div class="row">
      <div>
        <div style="font-weight:950">Order Summary</div>
        <div class="muted" id="who"></div>
      </div>
      <div style="text-align:right">
        <div class="muted">Total</div>
        <div style="font-weight:950;font-size:18px" id="total">GHS 0.00</div>
      </div>
    </div>

    <div class="items" id="items"></div>

    <div class="row" style="margin-top:10px">
      <div class="muted" id="delivery"></div>
      <div class="muted" id="paidAt"></div>
    </div>

    <div class="btns">
      <a class="btn primary" id="wa" href="#" target="_blank" rel="noreferrer">Send Order on WhatsApp</a>
      <a class="btn" href="index.html">Back to Menu</a>
    </div>
  </div>

  <div class="card muted" id="emptyCard" style="display:none">
    Could not load your order details (maybe you cleared browser storage). If you have your payment reference, contact Flavour Hub on WhatsApp.
  </div>
</div>

<script>
const WHATSAPP_WA = "233543748208"; // wa.me format
const fmt = n => `GHS ${Number(n || 0).toFixed(2)}`;

const params = new URLSearchParams(location.search);
const ref = params.get("ref") || "";
document.getElementById("refLine").textContent = `Reference: ${ref || "—"}`;

const raw = localStorage.getItem("fh_last_paid_order");
if(!raw){
  document.getElementById("emptyCard").style.display = "block";
} else {
  const o = JSON.parse(raw);
  document.getElementById("orderCard").style.display = "block";

  document.getElementById("who").textContent =
    `${o.customer?.name || ""} • ${o.customer?.phone || ""} • ${o.customer?.email || ""}`;

  document.getElementById("total").textContent = fmt(o.totals?.total || 0);

  const itemsEl = document.getElementById("items");
  itemsEl.innerHTML = "";
  (o.items || []).forEach(it => {
    const div = document.createElement("div");
    div.className = "it";
    div.innerHTML = `
      <div>
        <div style="font-weight:900">${escapeHtml(it.name || "")}</div>
        <div class="muted">${escapeHtml(it.category || "")}</div>
      </div>
      <div style="font-weight:900">x${Number(it.qty||0)}</div>
    `;
    itemsEl.appendChild(div);
  });

  const d = o.delivery || {};
  document.getElementById("delivery").textContent =
    (o.mode === "Delivery")
      ? `Delivery • ${d.distance_km ?? "—"} km • ETA ${d.eta || "—"} • Fee ${fmt(d.fee_ghs || 0)}`
      : `Pickup`;

  document.getElementById("paidAt").textContent = o.paidAt ? `Paid: ${new Date(o.paidAt).toLocaleString()}` : "";

  const message =
`Hello Flavour Hub, I just paid for my order.
Reference: ${o.reference}

Customer: ${o.customer?.name || ""} (${o.customer?.phone || ""})
Mode: ${o.mode}
Location: ${o.location || ""}

Items:
${(o.items||[]).map(i => `- ${i.name} x${i.qty}`).join("\n")}

Subtotal: ${fmt(o.totals?.subtotal || 0)}
Delivery: ${fmt(o.totals?.delivery || 0)}
Total: ${fmt(o.totals?.total || 0)}

Note: ${o.note || "-"}`;

  document.getElementById("wa").href =
    `https://wa.me/${WHATSAPP_WA}?text=${encodeURIComponent(message)}`;
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
}
</script>
</body>
</html>
